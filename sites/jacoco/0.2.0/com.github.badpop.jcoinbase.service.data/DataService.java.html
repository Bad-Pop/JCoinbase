<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JCoinbase</a> &gt; <a href="index.source.html" class="el_package">com.github.badpop.jcoinbase.service.data</a> &gt; <span class="el_source">DataService.java</span></div><h1>DataService.java</h1><pre class="source lang-java linenums">package com.github.badpop.jcoinbase.service.data;

import com.github.badpop.jcoinbase.JCoinbaseClient;
import com.github.badpop.jcoinbase.control.CallResult;
import com.github.badpop.jcoinbase.exception.JCoinbaseException;
import com.github.badpop.jcoinbase.model.CoinbaseError;
import com.github.badpop.jcoinbase.model.data.Currency;
import com.github.badpop.jcoinbase.model.data.ExchangeRates;
import com.github.badpop.jcoinbase.model.data.Price;
import com.github.badpop.jcoinbase.model.data.Price.PriceType;
import com.github.badpop.jcoinbase.model.data.Time;
import com.github.badpop.jcoinbase.service.ErrorManagerService;
import io.vavr.collection.Seq;
import lombok.AllArgsConstructor;
import lombok.extern.slf4j.Slf4j;

/** This service allows you to request coinbase public data. */
<span class="fc" id="L18">@Slf4j</span>
@AllArgsConstructor
public class DataService {

  private final JCoinbaseClient client;
  private final CoinbaseDataService service;

  /**
   * Get the Coinbase API server time.
   *
   * @return a {@link CallResult} containing a {@link Time} if it's ok, a list of {@link
   *     CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, Time&gt; getTimeAsJava() {
<span class="fc" id="L33">    return getTime().mapFailure(Seq::asJava);</span>
  }

  /**
   * Get the Coinbase API server time.
   *
   * @return a {@link CallResult} containing a {@link Time} if it's ok, a Seq of {@link
   *     CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;Seq&lt;CoinbaseError&gt;, Time&gt; getTime() {
<span class="fc" id="L44">    return service</span>
<span class="fc" id="L45">        .fetchTime(client)</span>
<span class="fc" id="L46">        .onSuccess(time -&gt; log.info(&quot;Successfully fetch Time resource : {}&quot;, time))</span>
<span class="fc" id="L47">        .onFailure(</span>
            throwable -&gt;
<span class="nc" id="L49">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase Time resource&quot;,
                    throwable))
<span class="fc" id="L53">        .get();</span>
  }

  /**
   * List Coinbase known currencies. Currency codes will conform to the ISO 4217 standard where
   * possible. Currencies which have or had no representation in ISO 4217 may use a custom code
   * (e.g. BTC).
   *
   * @return a {@link CallResult} containing a List of {@link Currency} if it's ok, a list of {@link
   *     CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, java.util.List&lt;Currency&gt;&gt; getCurrenciesAsJava() {
<span class="fc" id="L66">    return getCurrencies().map(Seq::asJava).mapFailure(Seq::asJava);</span>
  }

  /**
   * List Coinbase known currencies. Currency codes will conform to the ISO 4217 standard where
   * possible. Currencies which have or had no representation in ISO 4217 may use a custom code
   * (e.g. BTC).
   *
   * @return a {@link CallResult} containing a Seq of {@link Currency} if it's ok, a Seq of {@link
   *     CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;Seq&lt;CoinbaseError&gt;, Seq&lt;Currency&gt;&gt; getCurrencies() {
<span class="fc" id="L79">    return service</span>
<span class="fc" id="L80">        .fetchCurrencies(client)</span>
<span class="fc" id="L81">        .onSuccess(currencies -&gt; log.info(&quot;Successfully fetch Currencies resources&quot;))</span>
<span class="fc" id="L82">        .onFailure(</span>
            throwable -&gt;
<span class="nc" id="L84">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase Currencies resources&quot;,
                    throwable))
<span class="fc" id="L88">        .get();</span>
  }

  /**
   * Get current exchange rates for the given currency.
   *
   * @param currency the currency code. For example : BTC, USD, EUR, ETH, ...
   * @return a {@link CallResult} containing an {@link ExchangeRates} object if it's ok, a List of
   *     {@link CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, ExchangeRates&gt; getExchangeRatesAsJava(
      final String currency) {
<span class="fc" id="L101">    return getExchangeRates(currency).mapFailure(Seq::asJava);</span>
  }

  /**
   * Get current exchange rates for the given currency.
   *
   * @param currency the currency code. For example : BTC, USD, EUR, ETH, ...
   * @return a {@link CallResult} containing an {@link ExchangeRates} object if it's ok, a Seq of
   *     {@link CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;Seq&lt;CoinbaseError&gt;, ExchangeRates&gt; getExchangeRates(final String currency) {
<span class="fc" id="L113">    return service</span>
<span class="fc" id="L114">        .fetchExchangeRates(client, currency)</span>
<span class="fc" id="L115">        .onSuccess(</span>
            exchangeRates -&gt;
<span class="fc" id="L117">                log.info(&quot;Successfully fetch Exchange rates for currency {}&quot;, currency))</span>
<span class="fc" id="L118">        .onFailure(</span>
            throwable -&gt;
<span class="nc" id="L120">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase Exchange rates for currency : {}&quot;,
                    throwable,
                    currency))
<span class="fc" id="L125">        .get();</span>
  }

  /**
   * Get the total price to buy one currency with an other currency (e.g. BTC-USD to buy Bitcoin
   * with USD).
   *
   * @param priceType the price type to get (BUY, SELL or SPOT)
   * @param baseCurrency the base currency
   * @param targetCurrency the currency to determine price value
   * @return a {@link CallResult} containing an {@link Price} object if it's ok, a List of {@link
   *     CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, Price&gt; getPriceAsJava(
      final PriceType priceType, final String baseCurrency, final String targetCurrency) {
<span class="fc" id="L141">    return getPrice(priceType, baseCurrency, targetCurrency).mapFailure(Seq::asJava);</span>
  }

  /**
   * Get the total price to buy one currency with an other currency (e.g. BTC-USD to buy Bitcoin
   * with USD).
   *
   * @param priceType the price type to get (BUY, SELL or SPOT)
   * @param baseCurrency the base currency
   * @param targetCurrency the currency to determine price value
   * @return a {@link CallResult} containing an {@link Price} object if it's ok, a Seq of {@link
   *     CoinbaseError} otherwise.
   * @throws JCoinbaseException on unknown errors
   */
  public CallResult&lt;Seq&lt;CoinbaseError&gt;, Price&gt; getPrice(
      final PriceType priceType, final String baseCurrency, final String targetCurrency) {
<span class="fc" id="L157">    return service</span>
<span class="fc" id="L158">        .fetchPriceByType(client, priceType, baseCurrency, targetCurrency)</span>
<span class="fc" id="L159">        .onSuccess(</span>
            res -&gt;
<span class="fc" id="L161">                log.info(</span>
                    &quot;Successfully fetch price for currency={}, targetCurrency={} and priceType={}&quot;,
                    baseCurrency,
                    targetCurrency,
                    priceType))
<span class="fc" id="L166">        .onFailure(</span>
            throwable -&gt;
<span class="pc" id="L168">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase price for PriceType={}, currency{} and targetCurrency={}&quot;,
                    throwable,
<span class="fc" id="L172">                    priceType.getType(),</span>
                    baseCurrency,
                    targetCurrency))
<span class="fc" id="L175">        .get();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>