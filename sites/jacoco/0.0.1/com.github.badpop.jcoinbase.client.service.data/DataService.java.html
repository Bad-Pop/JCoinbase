<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JCoinbase</a> &gt; <a href="index.source.html" class="el_package">com.github.badpop.jcoinbase.client.service.data</a> &gt; <span class="el_source">DataService.java</span></div><h1>DataService.java</h1><pre class="source lang-java linenums">package com.github.badpop.jcoinbase.client.service.data;

import com.github.badpop.jcoinbase.client.JCoinbaseClient;
import com.github.badpop.jcoinbase.control.CallResult;
import com.github.badpop.jcoinbase.exception.JCoinbaseException;
import com.github.badpop.jcoinbase.model.CoinbaseError;
import com.github.badpop.jcoinbase.model.data.Currency;
import com.github.badpop.jcoinbase.model.data.ExchangeRates;
import com.github.badpop.jcoinbase.model.data.Price;
import com.github.badpop.jcoinbase.model.data.Price.PriceType;
import com.github.badpop.jcoinbase.model.data.Time;
import com.github.badpop.jcoinbase.service.ErrorManagerService;
import io.vavr.collection.Seq;
import lombok.AllArgsConstructor;
import lombok.extern.slf4j.Slf4j;

<span class="fc" id="L17">@Slf4j</span>
@AllArgsConstructor
public class DataService {

  private final JCoinbaseClient client;
  private final CoinbaseDataService service;

  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, Time&gt; getTimeAsJava() {
<span class="fc" id="L25">    return getTime().mapFailure(Seq::asJava);</span>
  }

  public CallResult&lt;Seq&lt;CoinbaseError&gt;, Time&gt; getTime() {
<span class="fc" id="L29">    return service</span>
<span class="fc" id="L30">        .fetchTime(client)</span>
<span class="fc" id="L31">        .onSuccess(time -&gt; log.info(&quot;Successfully fetch Time resource : {}&quot;, time))</span>
<span class="fc" id="L32">        .onFailure(</span>
            throwable -&gt;
<span class="nc" id="L34">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase Time resource&quot;,
                    throwable))
<span class="fc" id="L38">        .get();</span>
  }

  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, java.util.List&lt;Currency&gt;&gt; getCurrenciesAsJava() {
<span class="fc" id="L42">    return getCurrencies().map(Seq::asJava).mapFailure(Seq::asJava);</span>
  }

  public CallResult&lt;Seq&lt;CoinbaseError&gt;, Seq&lt;Currency&gt;&gt; getCurrencies() {
<span class="fc" id="L46">    return service</span>
<span class="fc" id="L47">        .fetchCurrencies(client)</span>
<span class="fc" id="L48">        .onSuccess(currencies -&gt; log.info(&quot;Successfully fetch Currencies resources&quot;))</span>
<span class="fc" id="L49">        .onFailure(</span>
            throwable -&gt;
<span class="nc" id="L51">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase Currencies resources&quot;,
                    throwable))
<span class="fc" id="L55">        .get();</span>
  }

  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, ExchangeRates&gt; getExchangeRatesAsJava(
      final String currency) {
<span class="fc" id="L60">    return getExchangeRates(currency).mapFailure(Seq::asJava);</span>
  }

  public CallResult&lt;Seq&lt;CoinbaseError&gt;, ExchangeRates&gt; getExchangeRates(final String currency) {
<span class="fc" id="L64">    return service</span>
<span class="fc" id="L65">        .fetchExchangeRates(client, currency)</span>
<span class="fc" id="L66">        .onSuccess(</span>
            exchangeRates -&gt;
<span class="fc" id="L68">                log.info(&quot;Successfully fetch Exchange rates for currency {}&quot;, currency))</span>
<span class="fc" id="L69">        .onFailure(</span>
            throwable -&gt;
<span class="nc" id="L71">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase Exchange rates for currency : {}&quot;,
                    throwable,
                    currency))
<span class="fc" id="L76">        .get();</span>
  }

  public CallResult&lt;java.util.List&lt;CoinbaseError&gt;, Price&gt; getPriceAsJava(
      final PriceType priceType, final String baseCurrency, final String targetCurrency) {
<span class="fc" id="L81">    return getPrice(priceType, baseCurrency, targetCurrency).mapFailure(Seq::asJava);</span>
  }

  public CallResult&lt;Seq&lt;CoinbaseError&gt;, Price&gt; getPrice(
      final PriceType priceType, final String baseCurrency, final String targetCurrency) {
<span class="fc" id="L86">    return service</span>
<span class="fc" id="L87">        .fetchPriceByType(client, priceType, baseCurrency, targetCurrency)</span>
<span class="fc" id="L88">        .onSuccess(</span>
            res -&gt;
<span class="fc" id="L90">                log.info(</span>
                    &quot;Successfully fetch price for currency={}, targetCurrency={} and priceType={}&quot;,
                    baseCurrency,
                    targetCurrency,
                    priceType))
<span class="fc" id="L95">        .onFailure(</span>
            throwable -&gt;
<span class="pc" id="L97">                ErrorManagerService.manageOnError(</span>
                    new JCoinbaseException(throwable),
                    &quot;An error occurred while fetching coinbase price for PriceType={}, currency{} and targetCurrency={}&quot;,
                    throwable,
<span class="fc" id="L101">                    priceType.getType(),</span>
                    baseCurrency,
                    targetCurrency))
<span class="fc" id="L104">        .get();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>